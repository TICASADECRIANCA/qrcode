<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Scanner ESCOLAPRO</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
    <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body class="bg-slate-900 text-white min-h-screen p-4 flex flex-col items-center">
    <div id="reader" class="w-full max-w-md rounded-3xl overflow-hidden mb-6"></div>
    <div id="res" class="hidden w-full max-w-md p-6 rounded-3xl text-center font-black text-xl"></div>
    <button onclick="location.reload()" class="mt-8 opacity-50 text-xs">REINICIAR SCANNER</button>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyA-F2p-sNG9ED7rpZ8uZ5_OxyiggdOfvfc", authDomain: "ingressoscdc.firebaseapp.com", databaseURL: "https://ingressoscdc-default-rtdb.firebaseio.com", projectId: "ingressoscdc", storageBucket: "ingressoscdc.firebasestorage.app", messagingSenderId: "388023812522", appId: "1:388023812522:web:1756fb37294146c0e5ebd3" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const scanner = new Html5Qrcode("reader");
        scanner.start({ facingMode: "environment" }, { fps: 10, qrbox: 250 }, (txt) => {
            scanner.pause();
            db.ref('ingressos/' + txt).once('value', snap => {
                const r = document.getElementById('res'); r.classList.remove('hidden');
                if(snap.exists()) {
                    const d = snap.val();
                    if(d.utilizado) {
                        r.className = "p-6 rounded-3xl bg-red-600 text-white";
                        r.innerText = "❌ JÁ UTILIZADO\n" + d.aluno;
                    } else {
                        r.className = "p-6 rounded-3xl bg-green-500 text-white";
                        r.innerText = "✅ LIBERADO\n" + d.aluno;
                        db.ref('ingressos/' + txt).update({ utilizado: true });
                    }
                } else {
                    r.className = "p-6 rounded-3xl bg-gray-600";
                    r.innerText = "⚠️ INVÁLIDO";
                }
            });
            setTimeout(() => { r.classList.add('hidden'); scanner.resume(); }, 4000);
        });
    </script>
</body>
</html>
